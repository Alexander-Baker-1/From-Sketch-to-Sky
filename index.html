<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Aircraft Generator - Stage 5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .ai-level-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .ai-level-btn {
            padding: 8px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ai-level-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #555;
            margin-bottom: 8px;
            font-weight: bold;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        button:disabled {
            opacity: 0.5;
        }

        #output {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .reasoning-box {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #ffc107;
        }

        .params-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
        }

        .param-item {
            padding: 5px 0;
            font-family: monospace;
        }

        .loading { color: #667eea; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úàÔ∏è AI Aircraft Part Generator</h1>
        <p class="subtitle">Stage 5: All Three AI Levels - Choose Your Intelligence!</p>
        
        <!-- AI Level Selector -->
        <div class="ai-level-selector">
            <button class="ai-level-btn active" data-level="minimum">Minimum AI</button>
            <button class="ai-level-btn" data-level="medium">Medium AI</button>
            <button class="ai-level-btn" data-level="maximum">Maximum AI</button>
        </div>
        
        <div class="input-group">
            <label>Gemini API Key:</label>
            <input type="text" id="apiKey" placeholder="Paste your API key">
        </div>
        
        <div class="input-group">
            <label>Describe Your Aircraft Part:</label>
            <textarea id="userInput" placeholder="Example: I need something for high-speed supersonic flight"></textarea>
        </div>
        
        <button id="generateBtn">Generate with AI</button>
        
        <div id="output">
            <p>Select an AI level and describe your part...</p>
        </div>
    </div>

    <script>
        // ============================================
        // AI LEVEL SELECTOR
        // ============================================
        let currentAILevel = 'minimum';

        document.querySelectorAll('.ai-level-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from all
                document.querySelectorAll('.ai-level-btn').forEach(b => b.classList.remove('active'));
                // Add to clicked
                this.classList.add('active');
                // Store selected level
                currentAILevel = this.dataset.level;
            });
        });

        // ============================================
        // MAIN GENERATION FUNCTION
        // ============================================
        document.getElementById('generateBtn').addEventListener('click', async function() {
            const userInput = document.getElementById('userInput').value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();
            const output = document.getElementById('output');
            const button = document.getElementById('generateBtn');

            if (!apiKey || !userInput) {
                output.innerHTML = '<p class="error">Please fill in all fields!</p>';
                return;
            }

            button.disabled = true;
            output.innerHTML = '<p class="loading">ü§ñ AI is thinking...</p>';

            try {
                const result = await callGeminiAPI(apiKey, userInput, currentAILevel);
                displayResult(result, currentAILevel);
            } catch (error) {
                output.innerHTML = `<p class="error">Error: ${error.message}</p>`;
            } finally {
                button.disabled = false;
            }
        });

        // ============================================
        // DISPLAY RESULTS
        // ============================================
        function displayResult(result, level) {
            const output = document.getElementById('output');
            let html = '';

            if (level === 'minimum') {
                // Just show text response
                html = `<h3 class="success">‚úì AI Response:</h3><p>${result}</p>`;
                
            } else if (level === 'medium') {
                // Show extracted parameters
                html = '<h3 class="success">‚úì Extracted Parameters:</h3>';
                html += '<div class="params-box">';
                for (const [key, value] of Object.entries(result)) {
                    if (value) {
                        html += `<div class="param-item"><strong>${key}:</strong> ${value}</div>`;
                    }
                }
                html += '</div>';
                
            } else if (level === 'maximum') {
                // Show reasoning + parameters
                html = '<h3 class="success">‚úì AI Recommendation:</h3>';
                html += '<div class="reasoning-box">';
                html += `<h4>üí° Reasoning:</h4><p>${result.reasoning}</p>`;
                html += '</div>';
                html += '<h4>üìä Recommended Parameters:</h4>';
                html += '<div class="params-box">';
                for (const [key, value] of Object.entries(result.parameters)) {
                    if (value) {
                        html += `<div class="param-item"><strong>${key}:</strong> ${value}</div>`;
                    }
                }
                html += '</div>';
            }

            output.innerHTML = html;
        }

        // ============================================
        // GEMINI API - ALL THREE LEVELS
        // ============================================
        async function callGeminiAPI(apiKey, userInput, aiLevel) {
            let prompt = '';

            // MINIMUM AI: Simple recognition
            if (aiLevel === 'minimum') {
                prompt = `You are an aircraft part identifier.
                
The user said: "${userInput}"

Identify what aircraft part they want in one simple sentence.`;
            }

            // MEDIUM AI: Extract parameters
            else if (aiLevel === 'medium') {
                prompt = `Extract parameters from this aircraft description and return ONLY valid JSON:

"${userInput}"

Format:
{
  "type": "wing/fuselage/stabilizer",
  "span": number or null,
  "length": number or null,
  "diameter": number or null,
  "sweep": number or null,
  "material": "string or null",
  "description": "brief summary"
}

Return ONLY JSON, no other text.`;
            }

            // MAXIMUM AI: Reasoning + recommendations
            else if (aiLevel === 'maximum') {
                prompt = `You are an aerospace engineering expert. Analyze this requirement and recommend the best aircraft part.

Requirement: "${userInput}"

Provide reasoning and recommend parameters. Return ONLY valid JSON:

{
  "reasoning": "Explain WHY this part is best for the requirement. Include engineering principles (aerodynamics, structure, performance). Be specific about trade-offs.",
  "parameters": {
    "type": "recommended part type",
    "span": number,
    "sweep": number,
    "material": "recommended material",
    "description": "part description"
  }
}

Example:
Input: "I need something for high-speed flight"
Output:
{
  "reasoning": "For high-speed flight, I recommend a delta wing. Delta wings provide: 1) Low drag at supersonic speeds due to swept leading edge, 2) Strong structure that handles high loads, 3) Sufficient internal volume for fuel. The 45¬∞ sweep angle is optimal for Mach 1.5-2.0 cruise speeds.",
  "parameters": {
    "type": "delta_wing",
    "span": 15,
    "sweep": 45,
    "material": "titanium alloy",
    "description": "Supersonic delta wing"
  }
}

Now analyze: "${userInput}"

Return ONLY JSON.`;
            }

            // Make API call
            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                }
            );

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || 'API failed');
            }

            const data = await response.json();
            const text = data.candidates[0].content.parts[0].text;

            // Return based on AI level
            if (aiLevel === 'minimum') {
                return text;  // Just return text
            } else {
                // Extract and parse JSON
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                } else {
                    throw new Error('Could not parse AI response');
                }
            }
        }
    </script>
</body>
</html>